server {
   listen 80;
   server_name host.docker.internal;

   # Enforce strict transport security
   add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

   # Root location
   root /usr/share/nginx/html;
   index index.html;

   # Handle all routes for SPA
   location / {
      try_files $uri $uri/ /index.html;
   }

   # Handle version file to prevent caching
   location /version.json {
      add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
      expires 0;
   }

   ## Not used, remove later!!!
   # WebSocket proxy for SignalR
   # location /notifications {
   #    proxy_pass http://host.docker.internal:9001;
   #    proxy_http_version 1.1;
   #    proxy_set_header Upgrade $http_upgrade;
   #    proxy_set_header Connection "Upgrade";
   #    proxy_set_header Host $host;
   #    proxy_set_header X-Real-IP $remote_addr;
   #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   # }

   # Static files caching for assets like JS, CSS, images
   location /assets/ {
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
   }

   # Enable gzip compression
   gzip on;
   gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
   gzip_min_length 1000;

   # Security headers
   add_header X-Content-Type-Options "nosniff";
   add_header X-Frame-Options "SAMEORIGIN";
   add_header X-XSS-Protection "1; mode=block";
   add_header Referrer-Policy "no-referrer-when-downgrade";

   # Logging configuration
   access_log /var/log/nginx/access.log;
   error_log /var/log/nginx/error.log;
}
